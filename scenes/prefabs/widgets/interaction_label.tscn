[gd_scene load_steps=2 format=3 uid="uid://bxyeghkx3u2iw"]

[sub_resource type="GDScript" id="GDScript_l1un2"]
script/source = "extends Widget

@onready var label: RichTextLabel = %label
var agent: Agent
var interactive: Interactive

func _ready() -> void:
	set_visible(false)
	set_process(false)

func set_agent(ag: Agent):
	agent = ag
	agent.interactive_changed.connect(_interactive_changed)

func _interactive_changed():
	var inter := agent._interactive
	if inter:
		set_process(true)
		label.text = inter.label
		modulate.a = 0.0
		visible = true
		interactive = inter
		UTween.parallel(self, { \"modulate:a\": 1.0 }, 0.2)
	else:
		UTween.parallel(self, { \"modulate:a\": 0.0 }, 0.2)\\
			.finished.connect(func():
				visible = false
				interactive = null
				set_process(false))

func _process(_delta: float) -> void:
	if not interactive: return
	var vp := Controllers.player.viewport
	var cam := vp.get_camera_3d()
	var pos_3d := interactive.global_position + interactive.label_world_space_offset
	var pos := cam.unproject_position(pos_3d)
	pos -= size * .5
	pos.x = clampf(pos.x, 0.0, vp.size.x)
	pos.y = clampf(pos.y, 0.0, vp.size.y)
	position = pos
	
"

[node name="hud_interaction_label" type="PanelContainer"]
mouse_filter = 2
script = SubResource("GDScript_l1un2")

[node name="MarginContainer" type="MarginContainer" parent="."]
layout_mode = 2
mouse_filter = 2
theme_override_constants/margin_left = 8
theme_override_constants/margin_top = 8
theme_override_constants/margin_right = 8
theme_override_constants/margin_bottom = 8

[node name="label" type="RichTextLabel" parent="MarginContainer"]
unique_name_in_owner = true
layout_mode = 2
mouse_filter = 2
bbcode_enabled = true
text = "Once Upon A Time"
fit_content = true
autowrap_mode = 0
